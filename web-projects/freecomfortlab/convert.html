<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- âœ… í˜ì´ì§€ ê¸°ë³¸ ì„¤ì • -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- âœ… SEO / ë©”íƒ€ ì •ë³´ -->
  <title>FreeComfortLab â€“ íŒŒì¼ ë³€í™˜ ì‹¤í—˜ì‹¤</title>
  <meta name="description" content="ìœ íŠœë¸Œ ìŒì›Â·ë…¹ìŒ íŒŒì¼ ë“±ì„ mp3ë¡œ ë³€í™˜í•˜ëŠ” FreeComfortLab íŒŒì¼ ë³€í™˜ ì‹¤í—˜ì‹¤ì…ë‹ˆë‹¤." />

  <!-- âœ… ê¸°ë³¸ ìŠ¤íƒ€ì¼ -->
  <style>
    /* ì „ì²´ ë°°ê²½ / í°íŠ¸ */
    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top left, #20263a 0, #05060a 55%);
      font-family: -apple-system, BlinkMacSystemFont, "Pretendard", system-ui, sans-serif;
      color: #ffffff;
    }

    a {
      text-decoration: none;
      color: #a3b2ff;
    }

    /* ì „ì²´ ë ˆì´ì•„ì›ƒ ë˜í¼ */
    .page-wrapper {
      max-width: 960px;
      margin: 0 auto;
      padding: 32px 16px 56px;
    }

    /* ìƒë‹¨ ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */
    .btn-back {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 6px 12px;
      border-radius: 999px;
      background: #181b24;
      border: 1px solid #2a2f3a;
      font-size: 13px;
      color: #aab3cf;
      margin-bottom: 20px;
      cursor: pointer;
      transition: background 0.15s ease, border-color 0.15s ease, transform 0.05s;
    }

    .btn-back:hover {
      background: #202435;
      border-color: #3a4bff66;
      transform: translateY(-1px);
    }

    /* ìƒë‹¨ íƒ€ì´í‹€ ì˜ì—­ */
    .header-title {
      margin-bottom: 28px;
    }

    .header-title h1 {
      font-size: 28px;
      margin: 0 0 6px;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .header-title .sub {
      font-size: 14px;
      color: #9aa4c6;
      line-height: 1.6;
    }

    /* ì¹´ë“œ ë°•ìŠ¤ (í¼ ì˜ì—­) */
    .card {
      background: #12151e;
      border-radius: 16px;
      padding: 24px 20px 20px;
      border: 1px solid #262c3c;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.45);
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .card-sub {
      font-size: 13px;
      color: #8d95aa;
      margin-bottom: 18px;
      line-height: 1.6;
    }

    /* í¼ ê³µí†µ ë¼ë²¨ */
    .form-label {
      display: block;
      font-size: 14px;
      margin-bottom: 6px;
      color: #ced3f5;
    }

    .form-row {
      margin-bottom: 18px;
    }

    /* íŒŒì¼ ì…ë ¥ ì»¤ìŠ¤í…€ */
    .file-input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .file-input {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }

    .file-button {
      padding: 10px 16px;
      border-radius: 10px;
      background: #1c2130;
      border: 1px solid #30364a;
      font-size: 14px;
      cursor: pointer;
      color: #e2e7ff;
      white-space: nowrap;
      transition: background 0.15s ease, border-color 0.15s ease, transform 0.05s;
    }

    .file-button:hover {
      background: #23293a;
      border-color: #4f8cff80;
      transform: translateY(-1px);
    }

    .file-name {
      flex: 1;
      font-size: 13px;
      color: #8e96b1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* ì…€ë ‰íŠ¸ ë°•ìŠ¤ */
    select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #30364a;
      background: #10131b;
      color: #e6ebff;
      font-size: 14px;
      outline: none;
      appearance: none;
      background-image: linear-gradient(45deg, transparent 50%, #8c94b0 50%),
                        linear-gradient(135deg, #8c94b0 50%, transparent 50%);
      background-position: calc(100% - 14px) 50%, calc(100% - 9px) 50%;
      background-size: 6px 6px, 6px 6px;
      background-repeat: no-repeat;
    }

    select:focus {
      border-color: #4f8cff;
      box-shadow: 0 0 0 1px #4f8cff55;
    }

    /* ë©”ì¸ ì œì¶œ ë²„íŠ¼ */
    .btn-primary {
      width: 100%;
      padding: 12px 16px;
      border-radius: 12px;
      border: none;
      background: #4f8cff;
      font-size: 15px;
      font-weight: 600;
      color: #ffffff;
      cursor: pointer;
      margin-top: 4px;
      transition: background 0.15s ease, box-shadow 0.15s ease, transform 0.05s;
    }

    .btn-primary:hover {
      background: #6b9dff;
      box-shadow: 0 0 0 1px #6b9dff55;
      transform: translateY(-1px);
    }

    .btn-primary:active {
      background: #3e6ee0;
      transform: translateY(0);
      box-shadow: none;
    }

    .btn-primary:disabled {
      background: #3d4664;
      cursor: not-allowed;
      box-shadow: none;
      opacity: 0.9;
    }

    .btn-primary.loading {
      position: relative;
      background: #3d4664;
      cursor: wait;
    }

    .btn-primary.loading::after {
      content: "";
      position: absolute;
      right: 16px;
      top: 50%;
      width: 14px;
      height: 14px;
      margin-top: -7px;
      border-radius: 50%;
      border: 2px solid #cdd6ff;
      border-top-color: transparent;
      animation: spin 0.7s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* ì„¤ëª… / íŒíŠ¸ í…ìŠ¤íŠ¸ */
    .hint {
      font-size: 12px;
      color: #7f879c;
      line-height: 1.6;
      margin-top: 14px;
    }

    /* ì„œë²„ ì‘ë‹µ í‘œì‹œ ë°•ìŠ¤ */
    .status-box {
      margin-top: 18px;
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 13px;
      line-height: 1.5;
      background: #151826;
      border: 1px solid #2a3044;
      color: #c1c7e6;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .status-box.success {
      border-color: #3fbf7f;
      background: #13241b;
      color: #c9f7d9;
    }

    .status-box.error {
      border-color: #ff6478;
      background: #2a1319;
      color: #ffd5db;
    }

    .status-box.muted {
      opacity: 0.8;
    }

    /* í•˜ë‹¨ ì‘ì€ ê°ì¸ */
    .footer-note {
      margin-top: 20px;
      font-size: 11px;
      color: #737c96;
      text-align: right;
    }
  </style>
</head>

<body>
  <div class="page-wrapper">
    <!-- ğŸ”™ ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸° -->
    <a href="/" class="btn-back">â† FreeComfortLab ë©”ì¸ìœ¼ë¡œ</a>

    <!-- ğŸ§ª í˜ì´ì§€ íƒ€ì´í‹€ -->
    <header class="header-title">
      <h1>íŒŒì¼ ë³€í™˜ ì‹¤í—˜ì‹¤</h1>
      <p class="sub">
        í˜„ì¬ëŠ” <strong>mp3 ë³€í™˜ í…ŒìŠ¤íŠ¸</strong>ë§Œ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.<br />
        ì‹¤ì œ ë³€í™˜ í’ˆì§ˆÂ·ì†ë„ ê²€ì¦ì„ ìœ„í•œ ì‹¤í—˜ í˜ì´ì§€ì…ë‹ˆë‹¤.
      </p>
    </header>

    <!-- ğŸ“¦ ì—…ë¡œë“œ + í¬ë§· ì¹´ë“œ -->
    <section class="card">
      <div class="card-title">1ì°¨ ì‹¤í—˜: mp3 ë³€í™˜ í…ŒìŠ¤íŠ¸</div>
      <div class="card-sub">
        ì•„ë˜ í¼ì€ <strong>ì§‘ ë…¸íŠ¸ë¶ Flask ì„œë²„ + Cloudflare Worker</strong>ì™€ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.<br />
        ì§€ê¸ˆì€ â€œì„œë²„ê¹Œì§€ íŒŒì¼ì´ ì˜ ë„ì°©í•˜ëŠ”ì§€â€ë¥¼ í™•ì¸í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.
      </div>

      <!-- ğŸ”§ ì—…ë¡œë“œ / í¬ë§· ì„ íƒ í¼ -->
      <form id="convert-form">
        <!-- 1) íŒŒì¼ ì„ íƒ -->
        <div class="form-row">
          <label class="form-label" for="file-input">1. íŒŒì¼ ì„ íƒ</label>

          <div class="file-input-wrapper">
            <!-- ì‚¬ìš©ìê°€ í´ë¦­í•˜ëŠ” ì˜ˆìœ ë²„íŠ¼ -->
            <button type="button" class="file-button" id="file-button">íŒŒì¼ ì„ íƒ</button>

            <!-- ì‹¤ì œ íŒŒì¼ ì¸í’‹ (ë³´ì´ì§€ ì•Šê²Œ) -->
            <input
              id="file-input"
              class="file-input"
              type="file"
              name="file"
              accept="audio/*,video/mp4,video/x-matroska,.m4a,.wav"
            />

            <!-- ì„ íƒëœ íŒŒì¼ ì´ë¦„ í‘œì‹œ -->
            <div class="file-name" id="file-name">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</div>
          </div>

          <div class="hint">
            Â· ìœ íŠœë¸Œì—ì„œ ë°›ì€ ìŒì›, ë…¹ìŒ íŒŒì¼ ë“± <strong>ìŒì„±/ì˜ìƒ íŒŒì¼</strong>ì„ ì˜¬ë ¤ì£¼ì„¸ìš”.<br />
            Â· í˜„ì¬ëŠ” í…ìŠ¤íŠ¸ íŒŒì¼ì„ ì˜¬ë ¤ë„ ì„œë²„ê¹Œì§€ëŠ” ì „ì†¡ë˜ì§€ë§Œ, ì‹¤ì œ ë³€í™˜ì€ mp3ìš©ìœ¼ë¡œ ì„¤ê³„ ì¤‘ì…ë‹ˆë‹¤.
          </div>
        </div>

        <!-- 2) ë³€í™˜ í¬ë§· ì„ íƒ -->
        <div class="form-row">
          <label class="form-label" for="format-select">2. ë³€í™˜ í¬ë§·</label>
          <select id="format-select" name="format">
            <option value="mp3" selected>mp3ë¡œ ë³€í™˜ (í˜„ì¬ ì§€ì›)</option>
            <option value="keep" disabled>ì›ë³¸ ìœ ì§€ (ì¤€ë¹„ ì¤‘)</option>
            <option value="mp4" disabled>mp4ë¡œ ë³€í™˜ (ì¤€ë¹„ ì¤‘)</option>
            <option value="wav" disabled>wavë¡œ ë³€í™˜ (ì¤€ë¹„ ì¤‘)</option>
          </select>

          <div class="hint">
            Â· ì‹¤ì œ ë³€í™˜ì€ ìš°ì„  <strong>mp3</strong>ë§Œ ì—°ê²°í•˜ê³ ,<br />
            Â· ì´í›„ <strong>wav / mp4 / ì›ë³¸ ìœ ì§€</strong> ì˜µì…˜ì„ ìˆœì°¨ì ìœ¼ë¡œ ì¶”ê°€í•  ê³„íšì…ë‹ˆë‹¤.
          </div>
        </div>

        <!-- 3) ë³€í™˜ ìš”ì²­ ë²„íŠ¼ -->
        <button type="submit" class="btn-primary" id="submit-button">
          ë³€í™˜ ìš”ì²­ ë³´ë‚´ê¸°
        </button>
      </form>

      <!-- ğŸ§¾ ì„œë²„ ì‘ë‹µ / ì˜¤ë¥˜ í‘œì‹œ -->
      <div id="status-box" class="status-box muted">
        ì•„ì§ ìš”ì²­ ì „ì…ë‹ˆë‹¤. íŒŒì¼ì„ ì„ íƒí•˜ê³  [ë³€í™˜ ìš”ì²­ ë³´ë‚´ê¸°]ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.
      </div>

      <div class="footer-note">
        í˜„ì¬ êµ¬ì¡°: Cloudflare Pages â†’ Worker â†’ ì§‘ ë…¸íŠ¸ë¶ Flask ì„œë²„(/api/convert)
      </div>
    </section>
  </div>

  <!-- âœ… /api/convert í˜¸ì¶œ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    // DOMì´ ì¤€ë¹„ë˜ë©´ ì‹¤í–‰
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("convert-form");
      const fileInput = document.getElementById("file-input");
      const fileButton = document.getElementById("file-button");
      const fileNameLabel = document.getElementById("file-name");
      const formatSelect = document.getElementById("format-select");
      const submitButton = document.getElementById("submit-button");
      const statusBox = document.getElementById("status-box");

      // ğŸ‘‰ íŒŒì¼ ì„ íƒ ë²„íŠ¼ í´ë¦­ â†’ ì‹¤ì œ input í´ë¦­
      fileButton.addEventListener("click", function () {
        fileInput.click();
      });

      // ğŸ‘‰ íŒŒì¼ ì„ íƒ ì‹œ íŒŒì¼ ì´ë¦„ í‘œì‹œ
      fileInput.addEventListener("change", function () {
        if (!fileInput.files.length) {
          fileNameLabel.textContent = "ì„ íƒëœ íŒŒì¼ ì—†ìŒ";
          return;
        }
        const file = fileInput.files[0];
        fileNameLabel.textContent = file.name + " (" + Math.round(file.size / 1024) + "KB)";
      });

      // ğŸ‘‰ ìƒíƒœ ë°•ìŠ¤ì— ë©”ì‹œì§€ í‘œì‹œí•˜ëŠ” í—¬í¼
      function setStatus(message, type) {
        statusBox.textContent = message;
        statusBox.classList.remove("success", "error", "muted");
        if (type === "success") {
          statusBox.classList.add("success");
        } else if (type === "error") {
          statusBox.classList.add("error");
        } else {
          statusBox.classList.add("muted");
        }
      }

      // ğŸ‘‰ ë²„íŠ¼ ë¡œë”© ìƒíƒœ on/off
      function setLoading(isLoading) {
        if (isLoading) {
          submitButton.disabled = true;
          submitButton.classList.add("loading");
          submitButton.textContent = "ì„œë²„ë¡œ ì „ì†¡ ì¤‘â€¦";
        } else {
          submitButton.disabled = false;
          submitButton.classList.remove("loading");
          submitButton.textContent = "ë³€í™˜ ìš”ì²­ ë³´ë‚´ê¸°";
        }
      }

      // ğŸ‘‰ í¼ ì œì¶œ ì²˜ë¦¬
      form.addEventListener("submit", async function (event) {
        event.preventDefault();

        // 1) íŒŒì¼ ì„ íƒ ì—¬ë¶€ í™•ì¸
        if (!fileInput.files.length) {
          setStatus("ë¨¼ì € ì—…ë¡œë“œí•  íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", "error");
          return;
        }

        // 2) í˜„ì¬ëŠ” mp3ë§Œ ì§€ì› ì•ˆë‚´ (selectì—ì„œ ì´ë¯¸ ë§‰í˜€ìˆì§€ë§Œ ë³´í˜¸ìš©)
        const format = formatSelect.value || "mp3";
        if (format !== "mp3") {
          setStatus("í˜„ì¬ëŠ” mp3 ë³€í™˜ë§Œ ì§€ì›í•©ë‹ˆë‹¤. (ë‹¤ë¥¸ í¬ë§·ì€ ì¤€ë¹„ ì¤‘)", "error");
          return;
        }

        const file = fileInput.files[0];

        // 3) ì„œë²„ ì „ì†¡ ì¤€ë¹„
        const formData = new FormData();
        formData.append("file", file);
        formData.append("format", format);

        setLoading(true);
        setStatus("ì„œë²„ë¡œ íŒŒì¼ì„ ì „ì†¡í•˜ê³  ìˆìŠµë‹ˆë‹¤â€¦", null);

        try {
          const response = await fetch("/api/convert", {
            method: "POST",
            body: formData,
          });

          // JSON ì‘ë‹µ íŒŒì‹± ì‹œë„
          let data = null;
          try {
            data = await response.json();
          } catch (e) {
            // JSONì´ ì•„ë‹ˆë©´ í…ìŠ¤íŠ¸ë¡œ ë°›ì•„ì„œ ë³´ì—¬ì¤Œ
            const text = await response.text();
            setStatus("ì„œë²„ ì‘ë‹µì„ JSONìœ¼ë¡œ íŒŒì‹±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤:\n" + text, "error");
            return;
          }

          // HTTP ì—ëŸ¬ ì½”ë“œ ì²˜ë¦¬
          if (!response.ok) {
            setStatus(
              "ìš”ì²­ì€ ì „ì†¡ë˜ì—ˆìœ¼ë‚˜ ì„œë²„ì—ì„œ ì˜¤ë¥˜ë¥¼ ë°˜í™˜í–ˆìŠµë‹ˆë‹¤.\n\n" +
                "HTTP status: " +
                response.status +
                "\n" +
                JSON.stringify(data, null, 2),
              "error"
            );
            return;
          }

          // ì •ìƒ ì‘ë‹µ ì²˜ë¦¬
          setStatus(
            "ì„œë²„ì—ì„œ íŒŒì¼ì„ ì •ìƒì ìœ¼ë¡œ ë°›ì•˜ìŠµë‹ˆë‹¤.\n\n" +
              JSON.stringify(data, null, 2),
            "success"
          );
        } catch (err) {
          // ë„¤íŠ¸ì›Œí¬ / ê¸°íƒ€ ì˜¤ë¥˜
          setStatus("ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n" + err.message, "error");
        } finally {
          setLoading(false);
        }
      });
    });
  </script>
</body>
</html>
